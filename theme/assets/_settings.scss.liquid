/*
 * Default Variables
 */
$body_padding:                        20px !default;
$body_navbar_padding:                 50px !default;
$inverse_threshhold:                  60%;

$default-primary-background-colour:    white !default;
$default-secondary-background-colour:  #f8f8f8 !default;
$default-text-colour:                  #333 !default;
$default-link-colour:                  #428bca !default;

/*
 * Setting Variables
 */
$site-background-image:{% if settings.site-background-image != blank %}true{% else %}false{% endif %};
$body-background-colour: {% if settings.body-background-colour != blank %}{{ settings.body-background-colour }}{% else %}$default-primary-background-colour{% endif %};
$body-heading-colour: {% if settings.body-heading-colour != blank %}{{ settings.body-heading-colour }}{% else %}$default-text-colour{% endif %};
$body-text-colour: {% if settings.body-text-colour != blank %}{{ settings.body-text-colour }}{% else %}$default-text-colour{% endif %};
$body-link-colour: {% if settings.body-link-colour != blank %}{{ settings.body-link-colour }}{% else %}$default-link-colour{% endif %};

$navbar-background-colour: {% if settings.navbar-background-colour != blank %}{{ settings.navbar-background-colour }}{% else %}$default-secondary-background-colour{% endif %};
$navbar-text-colour: {% if settings.navbar-text-colour != blank %}{{ settings.navbar-text-colour }}{% else %}$body-text-colour{% endif %};
$navbar-link-colour: {% if settings.navbar-link-colour != blank %}{{ settings.navbar-link-colour }}{% else %}$body-link-colour{% endif %};
$fix-footer-navbar:{% if settings.fix-footer-navbar != blank %}true{% else %}false{% endif %};

$sidebar-background-colour: {% if settings.sidebar-background-colour != blank %}{{ settings.sidebar-background-colour }}{% else %}transparent{% endif %};
$sidebar-heading-colour: {% if settings.sidebar-heading-colour != blank %}{{ settings.sidebar-heading-colour }}{% else %}$body-heading-colour{% endif %};
$sidebar-text-colour: {% if settings.sidebar-text-colour != blank %}{{ settings.sidebar-text-colour }}{% else %}$body-text-colour{% endif %};
$sidebar-link-colour: {% if settings.sidebar-link-colour != blank %}{{ settings.sidebar-link-colour }}{% else %}$body-link-colour{% endif %};

$footer-background-colour: {% if settings.footer-background-colour != blank %}{{ settings.footer-background-colour }}{% else %}transparent{% endif %};
$footer-heading-colour: {% if settings.footer-heading-colour != blank %}{{ settings.footer-heading-colour }}{% else %}$body-heading-colour{% endif %};
$footer-text-colour: {% if settings.footer-text-colour != blank %}{{ settings.footer-text-colour }}{% else %}$body-text-colour{% endif %};
$footer-link-colour: {% if settings.footer-link-colour != blank %}{{ settings.footer-link-colour }}{% else %}$body-link-colour{% endif %};

{% for i in (i..5) %}
  {% assign c = i | plus: 1 %}
  {% assign slide = 'slide-' | append: c %}
  {% assign slide_dark = slide | append: '-dark' %}
  {% assign slide_position = slide | append: '-position' %}
  ${{ slide_dark }}: {% if settings[slide_dark] != blank %}true{% else %}false{% endif %};
  ${{ slide_position }}: {% if settings[slide_position] != blank %}{{ settings[slide_position] }}{% else %}bottom center{% endif %};
{% endfor %}
$slides: ($slide-1-dark $slide-1-position) ($slide-2-dark $slide-2-position) ($slide-3-dark $slide-3-position) ($slide-4-dark $slide-4-position) ($slide-5-dark $slide-5-position);

/*
 * Functions and Mixins
 */
@function button-colour( $colour, $strength: 100% ) {
  @return if(lightness($colour) > 80%, darken($colour, $strength), lighten($colour, $strength));
}

@function slide-colour( $dark, $text-colour, $strength: 100% ) {
  @return if($dark, darken($text-colour, $strength), lighten($text-colour, $strength));
}

@function darken-colour( $colour, $strength: 100% ) {
  @if $colour == transparent {
    $colour: $body-background-colour;
  }
  @return if(lightness($colour) > 10%, darken($colour, $strength), lighten($colour, $strength * 2));
}

@function lighten-colour( $colour, $background-colour, $strength: 100% ) {
  @if $colour == transparent {
    $colour: $body-background-colour;
  }
  @if $background-colour == transparent {
    $background-colour: $body-background-colour;
  }
  @return if(lightness($background-colour) > $inverse_threshhold, lighten($colour, $strength), darken($colour, $strength));
}

@mixin button-variant($colour, $button-background-colour, $border-colour, $background-colour) {
  color: $colour;
  background-color: $button-background-colour;
  border-color: $border-colour;

  &:hover,
  &:focus,
  &:active,
  &.active {
    color: $colour;
    background-color: darken-colour($button-background-colour, 8%);
    border-color: darken-colour($border-colour, 12%);
  }
  .open & { &.dropdown-toggle {
    color: $colour;
    background-color: darken-colour($button-background-colour, 8%);
    border-color: darken-colour($border-colour, 12%);
  } }
  &:active,
  &.active {
    background-image: none;
  }
  .open & { &.dropdown-toggle {
    background-image: none;
  } }
  &.disabled,
  &[disabled],
  fieldset[disabled] & {
    &,
    &:hover,
    &:focus,
    &:active,
    &.active {
      background-color: $button-background-colour;
          border-color: $border-colour;
    }
  }
}

@mixin background-colour($colour){
  background-color: $colour;
  .brand{
    border-color: darken-colour($colour, 7.5%);
  }
  .page-header{
    border-bottom-color: darken-colour($colour, 7.5%);
  }  
  hr{
    border-top-color: darken-colour($colour, 7.5%);
  }

  .table-bordered, .table-bordered > thead > tr > th, .table-bordered > thead > tr > td, .table-bordered > tbody > tr > th, .table-bordered > tbody > tr > td, .table-bordered > tfoot > tr > th, .table-bordered > tfoot > tr > td{
    border-color: darken-colour($colour, 7.5%);
  }
  
  .table-striped > tbody > tr:nth-child(odd) > td, .table-striped > tbody > tr:nth-child(odd) > th{
    background-color: darken-colour($colour, 4%);
  }
  
  .table-hover > tbody > tr:hover > td, .table-hover > tbody > tr:hover > th{
    background-color: darken-colour($colour, 6%);
  }
  
  @media (max-width: 768px){
    .dropdown-menu .divider{
      background-color: darken-colour($colour, 7.5%);
    }
  }
}

@mixin heading-colour($colour){
  h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6{
    color: $colour;
    & a{
      color: $colour;
      &:hover{
        color: darken-colour($colour, 15%);
      }
    }
  }
}

@mixin text-colour($text-colour, $background-colour){
  color: $text-colour;
  .thumbnail .caption, .btn-default{
    color: $text-colour;
  }
  .text-muted, .nav > li.disabled > a, .breadcrumb > .active{
    color: lighten-colour($text-colour, $background-colour, 40%);
  }
}

@mixin link-colour($link-colour, $background-colour){
  a{
    color: $link-colour;
    &:hover{
      color: darken-colour($link-colour, 15%);
    }
  }
  .nav > li > a:hover, .nav > li > a:focus{
    background-color: darken-colour($background-colour, 7.5%);
  }
  .nav-pills > li.active > a, .nav-pills > li.active > a:hover, .nav-pills > li.active > a:focus{
    color: button-colour($link-colour);
    background-color: $link-colour;
  }
  .dropdown-menu > .active > a, .dropdown-menu > .active > a:hover, .dropdown-menu > .active > a:focus{
    color: button-colour($link-colour);
    background-color: $link-colour;
  }
  .btn-primary {
    @include button-variant(button-colour($link-colour), $link-colour, darken($link-colour, 5%), $background-colour);
  }
  .pagination > .disabled > span, .pagination > .disabled > span:hover, .pagination > .disabled > span:focus, .pagination > .disabled > a, .pagination > .disabled > a:hover, .pagination > .disabled > a:focus{
    color: lighten-colour($link-colour, $background-colour, 40%);
  }
  .form-control:focus {
    border-color: $link-colour;
    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba($link-colour, 0.6);
    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba($link-colour, 0.6);
  }
}

@mixin slide($slide-dark, $slide-position, $text-colour){
  .carousel-caption{
    @if nth($slide-position, 1) == 'top' {
      top: 0;
      bottom: auto;
    } @else if nth($slide-position, 1) == 'middle' {
      top: 31%;
      bottom: auto;
    }
    @if nth($slide-position, 2) == 'left' {
      left: 10%;
      right: 20%;
      text-align: left;
    } @else if nth($slide-position, 2) == 'right' {
      left: 20%;
      right: 10%;
      text-align: right;
    }
    color: slide-colour($slide-dark, $text-colour);
    @if $slide-dark {
      text-shadow: none;
    }
    h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6{
      color: slide-colour($slide-dark, $text-colour);
      @if $slide-dark {
        text-shadow: none;
      }
    }
  }
}

/*
 * Styles
 */
body{
  /* Navbar placement */
  {% if settings.navbar-placement == 'fixed-to-top' %}padding-top: $body_navbar_padding + $body_padding;{% elsif settings.navbar-placement == 'main-content' and settings.logo-placement != "above-navbar" %}padding-top: $body_padding;{% endif %}
  {% if settings.navbar-placement != 'fixed-to-bottom' and settings.fix-footer-navbar %}padding-bottom: $body_navbar_padding + $body_padding;{% endif %}
  {% if settings.navbar-placement == 'fixed-to-bottom' %}
    {% unless settings.logo-placement == "above-navbar" %}padding-top: $body_padding;{% endunless %}
    padding-bottom: $body_navbar_padding;
    #footer-credits{
      padding-bottom: $body_navbar_padding - 2px;
    }
  {% endif %}
  {% if settings.navbar-placement == 'static-top' and settings.logo-placement == "above-navbar" %}
  .brand{
    margin-bottom: 0;
    @if $navbar-background-colour == $body-background-colour {
      border: none;
    } @else {
      border-color: darken-colour($footer-background-colour, 7.5%);
    }
  }
  {% endif %}
  
  /* Design and colour schemes */
  @if $site-background-image {
    background-image: url('{{ 'site-background-image-file.jpg' | asset_url }}');
    {% unless settings.site-background-image-repeat == blank %}background-repeat: {{ settings.site-background-image-repeat }};{% endunless %}
    {% unless settings.site-background-image-position == blank %}background-position: {{ settings.site-background-image-position }};{% endunless %}
  }
  
  @include background-colour($body-background-colour);
  @include heading-colour($body-heading-colour);
  @include text-colour($body-text-colour, $body-background-colour);
  @include link-colour($body-link-colour, $body-background-colour);
}

.breadcrumb{
  background-color: darken-colour($body-background-colour, 7.5%);
}
.breadcrumb > li + li:before{
  color: lighten-colour($body-text-colour, $body-background-colour, 45%);
}

.navbar-default{
  @include background-colour($navbar-background-colour);
  @include text-colour($navbar-text-colour, $navbar-background-colour);
  @include link-colour($navbar-link-colour, $navbar-background-colour);
  @if $navbar-background-colour == $body-background-colour {
    border: none;
  } @else {
    border-color: darken-colour($footer-background-colour, 7.5%);
  }
  .navbar-nav {
    > li > a{
      color: $navbar-link-colour;
      &:hover, &:focus{
        color: darken-colour($navbar-link-colour, 15%);
      }
    }
    > .dropdown > a{
      .caret{
        border-top-color: $navbar-link-colour;
        border-bottom-color: $navbar-link-colour;
      }
      &:hover .caret, &:focus .caret{
        border-top-color: darken-colour($navbar-link-colour, 15%);
        border-bottom-color: darken-colour($navbar-link-colour, 15%);
      }
    }
    .open .dropdown-menu > li > a{
      color: $navbar-link-colour;
      &:hover, &:focus{
        color: darken-colour($navbar-link-colour, 15%);
      }
    }
    > .active > a, > .active > a:hover, > .active > a:focus, .open > a, .open > a:hover, .open > a:focus{
      color: darken-colour($navbar-link-colour, 15%);
      background-color: darken-colour($navbar-background-colour, 7.5%);
    }
  }
  .navbar-brand{
    color: $body-heading-colour;
    &:hover{
      color: darken-colour($body-heading-colour, 15%);
    }
  }
  .navbar-toggle{
    border-color: darken-colour($navbar-background-colour, 7.5%);
    .icon-bar{
      background-color: darken-colour($navbar-background-colour, 7.5%);
    }
    &:hover, &:focus{
      background-color: darken-colour($navbar-background-colour, 4%);
    }
  }
  .navbar-collapse, .navbar-form{
    border-color: darken-colour($navbar-background-colour, 7.5%);
  }
}

.sidebar{
  @include background-colour($sidebar-background-colour);
  @include heading-colour($sidebar-heading-colour);
  @include text-colour($sidebar-text-colour, $sidebar-background-colour);
  @include link-colour($sidebar-link-colour, $sidebar-background-colour);
}

#footer-content{
  @include background-colour($footer-background-colour);
  @include heading-colour($footer-heading-colour);
  @include text-colour($footer-text-colour, $footer-background-colour);
  @include link-colour($footer-link-colour, $footer-background-colour);
  @if $fix-footer-navbar{
    padding-bottom: 80px;
  }
  .container{
    @if $site-background-image == false and ($footer-background-colour == $body-background-colour or $footer-background-colour == transparent) {
      border-top-color: darken-colour($footer-background-colour, 7.5%);
    } @else {
      border-top: none;
    }
  }
}

#footer-credits{
  @if $fix-footer-navbar {
    border-color: darken-colour($navbar-background-colour, 7.5%);
  } @else {
    border: none;
  }
}

.carousel-caption{
  color: $body-text-colour;
  background-color: $body-background-colour;
  border-color: darken-colour($body-background-colour, 7.5%);
}
.carousel-indicators li{
  border-color: $body-text-colour;
}
.carousel-indicators .active{
  background-color: $body-text-colour;
}

@media (min-width: 768px){
  .sidebar{
    background-color: transparent;
    .sidebar-content{
      background-color: $sidebar-background-colour;
      @if $site-background-image == false and ($sidebar-background-colour == $body-background-colour or $sidebar-background-colour == transparent) {
        padding: 0;
      }
    }
  }
  
  $i: 1;
  @each $slide in $slides{
    #slide-#{$i}{
      @include slide(nth($slide, 1), nth($slide, 2), $body-text-colour);
    }
    $i: $i + 1;
  }
  .carousel-caption{
    background-color: transparent;
  }
  .carousel-indicators li{
    border-color: white;
  }
  .carousel-indicators .active{
    background-color: white;
  }
}

{% unless settings.custom-css == blank %}{{ settings.custom-css }}{% endunless %}